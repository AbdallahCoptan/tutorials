<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>MATLAB - UL HPC Tutorials</title>
  

  <link rel="shortcut icon" href="../../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "MATLAB";
    var mkdocs_page_input_path = "advanced/MATLAB1/README.md";
    var mkdocs_page_url = "/advanced/MATLAB1/README/";
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js"></script>
  <script src="../../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../../js/highlight.pack.js"></script>
  <script src="../../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> UL HPC Tutorials</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Basic Tutorials</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../basic/getting_started/">Getting Started</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../../basic/sequential_jobs/">HPC workflow with sequential jobs</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Debug/">Efficient Debugging</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Advanced Software Management</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../EasyBuild/">Easybuild</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../RESIF/">RESIF</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>MPI / Performance Evaluation</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../OSU_MicroBenchmarks/">OSU Micro-benchmarks</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../HPL/">High Performance Linpack (HPL)</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../HPCG/">High Performance Conjugate Gradient (HPCG)</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Mathematics</span></li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">MATLAB</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#matlab-interactive-passive-and-sequential-jobs-checkpointing-and-parallel-jobs-execution-on-the-ul-hpc-platform">MATLAB (interactive, passive and sequential jobs, checkpointing and parallel jobs) execution on the UL HPC platform</a></li>
                
                    <li><a class="toctree-l4" href="#prerequisites">Prerequisites</a></li>
                
                    <li><a class="toctree-l4" href="#matlab-execution-in-interactive-mode">Matlab execution in interactive mode</a></li>
                
                    <li><a class="toctree-l4" href="#checking-available-toolboxes-and-license-status">Checking available toolboxes and license status</a></li>
                
                    <li><a class="toctree-l4" href="#matlab-execution-in-passive-mode">Matlab execution in passive mode</a></li>
                
                    <li><a class="toctree-l4" href="#useful-references">Useful references</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../R/">R - statistical computing</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Bioinformatics</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Bioinformatics/">Running bioinformatics software</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Galaxy/">Galaxy</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Parallel Debuggers</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Allinea/">Allinea</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../TotalView/">TotalView</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Virtualization</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Vagrant/">Vagrant</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vm5k/">Grid5000 - Automatic VM deployment with VM5K</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>CFD/MD/Chemistry</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../MultiPhysics/">Advanced Parallel execution</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Big Data</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Spark/">Big Data Application Over Apache Spark</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Advanced topics</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../advanced_workflows/README/">Advanced workflows on sequential jobs management</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../advanced_scheduling/">Advanced scheduling with SLURM</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../Python/">Prototyping with Python</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ReproducibleResearch/">Reproducible Research</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../../rtfd/">Documentation (RTFD)</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../../contributing/">Contributing</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../../contacts/">Contacts</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">UL HPC Tutorials</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
        
          <li>Mathematics &raquo;</li>
        
      
    
    <li>MATLAB</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <p>-<em>- mode: markdown; mode: visual-line; fill-column: 80 -</em>-</p>
<p>Author: Valentin Plugaru <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#86;&#97;&#108;&#101;&#110;&#116;&#105;&#110;&#46;&#80;&#108;&#117;&#103;&#97;&#114;&#117;&#64;&#117;&#110;&#105;&#46;&#108;&#117;">&#86;&#97;&#108;&#101;&#110;&#116;&#105;&#110;&#46;&#80;&#108;&#117;&#103;&#97;&#114;&#117;&#64;&#117;&#110;&#105;&#46;&#108;&#117;</a><br />
Copyright (c) 2013-2017 UL HPC Team  <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#104;&#112;&#99;&#45;&#115;&#121;&#115;&#97;&#100;&#109;&#105;&#110;&#115;&#64;&#117;&#110;&#105;&#46;&#108;&#117;">&#104;&#112;&#99;&#45;&#115;&#121;&#115;&#97;&#100;&#109;&#105;&#110;&#115;&#64;&#117;&#110;&#105;&#46;&#108;&#117;</a></p>
<hr />
<h1 id="matlab-interactive-passive-and-sequential-jobs-checkpointing-and-parallel-jobs-execution-on-the-ul-hpc-platform">MATLAB (interactive, passive and sequential jobs, checkpointing and parallel jobs) execution on the UL HPC platform</h1>
<p><a href="https://hpc.uni.lu"><img alt="By ULHPC" src="https://img.shields.io/badge/by-ULHPC-blue.svg" /></a> <a href="http://www.gnu.org/licenses/gpl-3.0.html"><img alt="Licence" src="https://img.shields.io/badge/license-GPL--3.0-blue.svg" /></a> <a href="https://github.com/ULHPC/tutorials/issues/"><img alt="GitHub issues" src="https://img.shields.io/github/issues/ULHPC/tutorials.svg" /></a> <a href="https://github.com/ULHPC/tutorials/raw/devel/advanced/MATLAB1/MATLAB1.pdf"><img alt="" src="https://img.shields.io/badge/slides-PDF-red.svg" /></a> <a href="https://github.com/ULHPC/tutorials/tree/devel/advanced/MATLAB1/"><img alt="Github" src="https://img.shields.io/badge/sources-github-green.svg" /></a> <a href="http://ulhpc-tutorials.readthedocs.io/en/latest/advanced/MATLAB1/"><img alt="Documentation Status" src="http://readthedocs.org/projects/ulhpc-tutorials/badge/?version=latest" /></a> <a href="https://github.com/ULHPC/tutorials"><img alt="GitHub forks" src="https://img.shields.io/github/stars/ULHPC/tutorials.svg?style=social&amp;label=Star" /></a></p>
<p><a href="https://github.com/ULHPC/tutorials/raw/devel/advanced/MATLAB1/MATLAB1.pdf"><img alt="" src="https://github.com/ULHPC/tutorials/raw/devel/advanced/MATLAB1/cover_MATLAB1.png" /></a>
<a href="https://github.com/ULHPC/tutorials/raw/devel/advanced/MATLAB1/MATLAB2.pdf"><img alt="" src="https://github.com/ULHPC/tutorials/raw/devel/advanced/MATLAB1/cover_MATLAB2.png" /></a></p>
<p>The objective of this tutorial is to exemplify the execution of <a href="http://www.matlab.com">MATLAB</a> -
a high-level language and interactive environment for numerical computation,
visualization and programming, on top of the <a href="http://hpc.uni.lu">UL HPC</a> platform.</p>
<p>The tutorial will show you:</p>
<ol>
<li>how to run MATLAB in interactive mode, with either the full graphical interface or the text-mode interface</li>
<li>how to check the available toolboxes and licenses used</li>
<li>how to run MATLAB in passive (batch) mode, enabling unattended execution on the clusters</li>
<li>how to use MATLAB script (.m) files</li>
<li>how to plot data, saving the plots to file</li>
<li>how to take advantage of some of the paralelization capabilities of MATLAB to speed up your tasks</li>
</ol>
<p>For the tutorial we will use the UL HPC <a href="http://hpc.uni.lu/systems/gaia/">Gaia</a> cluster that includes nodes with GPU accelerators.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>As part of this tutorial two Matlab example scripts have been developed and you will need to download them,
along with their dependencies, before following the instructions in the next sections:</p>
<pre><code>    (gaia-frontend)$&gt; mkdir -p ~/matlab-tutorial/code
    (gaia-frontend)$&gt; cd ~/matlab-tutorial/code
    (gaia-frontend)$&gt; wget --no-check-certificate https://raw.github.com/ULHPC/tutorials/devel/advanced/MATLAB1/code/example1.m
    (gaia-frontend)$&gt; wget --no-check-certificate https://raw.github.com/ULHPC/tutorials/devel/advanced/MATLAB1/code/example2.m
    (gaia-frontend)$&gt; wget --no-check-certificate https://raw.github.com/ULHPC/tutorials/devel/advanced/MATLAB1/code/google_finance_data.m
</code></pre>
<p>Or simply clone the full tutorials repository and make a link to the MATLAB tutorial:</p>
<pre><code>    (gaia-frontend)$&gt; git clone https://github.com/ULHPC/tutorials.git
    (gaia-frontend)$&gt; ln -s tutorials/advanced/MATLAB1/ ~/matlab-tutorial
</code></pre>
<h2 id="matlab-execution-in-interactive-mode">Matlab execution in interactive mode</h2>
<h3 id="launching-the-full-graphical-environment">Launching the full graphical environment</h3>
<p>Running the full MATLAB environment (e.g. on the Gaia cluster) requires an <a href="https://hpc.uni.lu/users/docs/oar.html#concepts">interactive OAR session</a>. When connecting to the clusters you will
need to enable X11 forwarding in order for the graphical environment to be shown on your
local machine:</p>
<ul>
<li>
<p>on Linux simply follow the commands below</p>
</li>
<li>
<p>on OS X (depending on version) you may not have the X Window System installed,
  and thus will need to install <a href="http://xquartz.macosforge.org/landing/">XQuartz</a> if
  the first command below returns an 'X11 forwarding request failed on channel 0' error</p>
</li>
<li>
<p>on Windows you will need to run <a href="http://sourceforge.net/projects/vcxsrv/">VcXsrv</a> first
  then to configure Putty (Connection -&gt; SSH -&gt; X11 -&gt; Enable X11 forwarding) before
  logging in to the clusters.</p>
<pre><code># Connect to Gaia with X11 forwarding enabled (Linux/OS X):
(yourmachine)$&gt; ssh access-gaia.uni.lu -X

# Request an interactive job (the default parameters get you 1 core for 2 hours):
(gaia-frontend)$&gt; oarsub -I

# Check the Matlab versions installed on the clusters:
(node)$&gt; module spider matlab

# Load a specific MATLAB version:
(node)$&gt; module load base/MATLAB/2017a

# Check that its profile has been loaded and thus we can start to use it:
(node)$&gt; module list

# Launch MATLAB
(node)$&gt; matlab
</code></pre>
</li>
</ul>
<p>After a delay, the full Matlab interface will be displayed on your machine and you will be able to run commands, load and edit
scripts and generate plots. An alternative to the graphical interface is the command-line (text-mode) interface, which is
enabled through specific parameters, described in the following section.</p>
<h3 id="launching-the-command-line-environment">Launching the command-line environment</h3>
<p>Running the text-mode MATLAB interface in an interactive session, is much faster than
using the full graphical environment through the network and is useful for commands/scripts testing and
quick executions:</p>
<pre><code>    # First, connect to an UL cluster (e.g. Gaia):

    (yourmachine)$&gt; ssh access-gaia.uni.lu
    (gaia-frontend)$&gt; oarsub -I
    (node)$&gt; module load base/MATLAB/2017a

    # Launch MATLAB with the graphical display mode disabled (critical parameters):
    (node)$&gt; matlab -nodisplay -nosplash
    Opening log file:  /home/users/vplugaru/java.log.23247

                                                                   &lt; M A T L A B (R) &gt;
                                                         Copyright 1984-2017 The MathWorks, Inc.
                                                          R2017a (9.2.0.538062) 64-bit (glnxa64)
                                                                    February 23, 2017
    To get started, type one of these: helpwin, helpdesk, or demo.
    For product information, visit www.mathworks.com.
    &gt;&gt; version()
    ans =
        '9.2.0.538062 (R2017a)
</code></pre>
<p>In this command line you are now able to run Matlab commands, load and edit scripts, but cannot display plots - they can
however be generated and exported to file, which you will need to transfer to your own machine for visualisation.
While the text mode interface is spartan, you still benefit from tab-completion (type the first few letters of
a command then press TAB twice to see possible completions) and can run the integrated help with <code>help command_name</code>
(e.g. help plot3).</p>
<h3 id="example-usage-of-matlab-in-interactive-mode">Example usage of Matlab in interactive mode</h3>
<p>At this point you should have downloaded the example scripts and started Matlab either with the graphical or the text-mode
interface. We will now test some Matlab commands by using the google_finance_data function defined in <em>google_finance_data.m</em>.
This function downloads stock market data through the Google Finance API, and we will use it to get 1 month worth of stock data
for IBM (whose stock symbol is 'IBM'):</p>
<pre><code>     &gt;&gt; cd('~/matlab-tutorial/code/')
     &gt;&gt; [hist_date, hist_high, hist_low, hist_open, hist_close, hist_vol] = google_finance_data('IBM', '2017-05-01', '2017-06-02');
     &gt;&gt; size(hist_date)
     ans =
         24     1
     &gt;&gt; [hist_date{1} ' ' hist_date{end}]
     ans =
         '1-May-17 2-Jun-17'
     &gt;&gt; min(hist_low)
     ans =
       149.7900
     &gt;&gt; max(hist_high)
     ans =
       160.4200
     &gt;&gt; mean(hist_close)
     ans =
       153.2879
     &gt;&gt; std(hist_close)
     ans =
         2.7618
</code></pre>
<p>Through these commands we have seen that the function returns column vectors, we were able to get 24 days' worth of information and
we used simple statistic functions to get an idea of how the stock varied in the given period.</p>
<p>Now we will use the example1.m script that shows:
  - how to use different plotting methods on the data retrieved with the google_finance_data function
  - how to export the plots in different graphic formats instead of displaying them (which is only available when running the
  full graphical environment and also allows the user to visually interact with the plot)</p>
<pre><code>     &gt;&gt; example1
     Elapsed time is 1.709865 seconds.
     &gt;&gt; quit
     (node)$&gt;
     (node)$&gt; ls *pdf *eps
     example1-2dplot.eps  example1-2dplot.pdf  example1-scatter.eps
</code></pre>
<p>We have run the example1.m script which has downloaded Apple ('AAPL' ticker) stock data for the year 2016 and generated three plots:</p>
<ul>
<li>example1-2dplot.pdf : color PDF generated with the saveas function, plotting dates (x-axis) vs closing stock price (y-axis)</li>
<li>example1-2dplot.eps : high quality black and white Enhanced PostScript (EPS) generated with the print function, same data as above</li>
<li>example1-scatter.eps : high quality color EPS generated with the print function, showing also the trading volume (z-axis) and
using different color datapoints (red) where the closing share price was above 100</li>
</ul>
<p>The script has also used the tic/toc Matlab commands to time it's execution and we can see it took less than 2 seconds to download
and process data from the Google Finance API and generate the plots.</p>
<p>Finally, we have closed our Matlab session and were returned to the cluster's command line prompt where we found the generated plots.</p>
<p>A PNG version of the latter two plots is shown below:
<img alt="2D Plot" src="https://raw.githubusercontent.com/ULHPC/tutorials/devel/advanced/MATLAB1/src/plots/example1-2dplot.png" />
<img alt="3D Scatter Plot" src="https://raw.githubusercontent.com/ULHPC/tutorials/devel/advanced/MATLAB1/src/plots/example1-scatter.png" /></p>
<p>Further examples showing serial and parallel executions are given below in the 'Example usage of Matlab in passive mode' section.</p>
<h2 id="checking-available-toolboxes-and-license-status">Checking available toolboxes and license status</h2>
<p>In order to be able to run MATLAB and specific features provided through the various MATLAB toolboxes, sufficient licenses need to
be available. The state of the licenses can be checked with the <code>lmstat</code> utility.</p>
<p>First, we will check that the license server is running (an <strong>UP</strong> status should be shown in the output of lmutil):</p>
<pre><code>     (node)$&gt; module load base/MATLAB
     (node)$&gt; $EBROOTMATLAB/etc/glnxa64/lmutil lmstat -c $EBROOTMATLAB/licenses/network.lic
</code></pre>
<p>Next, we can check the total number of MATLAB licenses available (issued) and how many are used:</p>
<pre><code>     (node)$&gt; $EBROOTMATLAB/etc/glnxa64/lmutil lmstat -c $EBROOTMATLAB/licenses/network.lic -f MATLAB
</code></pre>
<p>To check for a specific feature and its usage (e.g. the financial toolbox if we know its name):</p>
<pre><code>     (node)$&gt; $EBROOTMATLAB/etc/glnxa64/lmutil lmstat -c $EBROOTMATLAB/licenses/network.lic -f Financial_toolbox
</code></pre>
<p>To see all available toolboxes:</p>
<pre><code>     (node)$&gt; $EBROOTMATLAB/etc/glnxa64/lmutil lmstat -c $EBROOTMATLAB/licenses/network.lic -a
</code></pre>
<p>Checking the availability of statistics toolboxes (if we don't know the exact name, but that 'stat' is in the name):</p>
<pre><code>     (node)$&gt; $EBROOTMATLAB/etc/glnxa64/lmutil lmstat -c $EBROOTMATLAB/licenses/network.lic -a | grep -i stat
</code></pre>
<p>Finally, checking the available toolboxes (but with no information on the specific # of available/used licenses), can be done directly from MATLAB, e.g.:</p>
<pre><code>     (node)$&gt; module load base/MATLAB/2017a
     (node)$&gt; matlab -nodesktop -nodisplay
     Opening log file:  /home/users/vplugaru/java.log.6343
                                                                 &lt; M A T L A B (R) &gt;
                                                       Copyright 1984-2017 The MathWorks, Inc.
                                                        R2017a (9.2.0.538062) 64-bit (glnxa64)
                                                                  February 23, 2017


     To get started, type one of these: helpwin, helpdesk, or demo.
     For product information, visit www.mathworks.com.

     &gt;&gt; ver
     ----------------------------------------------------------------------------------------------------
     MATLAB Version: 9.2.0.538062 (R2017a)
     MATLAB License Number: 886910
     Operating System: Linux 3.16.0-4-amd64 #1 SMP Debian 3.16.43-2+deb8u3 (2017-08-15) x86_64
     Java Version: Java 1.7.0_60-b19 with Oracle Corporation Java HotSpot(TM) 64-Bit Server VM mixed mode
     ----------------------------------------------------------------------------------------------------
     MATLAB                                                Version 9.2         (R2017a)
     Simulink                                              Version 8.9         (R2017a)
     Aerospace Blockset                                    Version 3.19        (R2017a)
     Aerospace Toolbox                                     Version 2.19        (R2017a)
     Antenna Toolbox                                       Version 2.2         (R2017a)
     Bioinformatics Toolbox                                Version 4.8         (R2017a)
     Communications System Toolbox                         Version 6.4         (R2017a)
     Computer Vision System Toolbox                        Version 7.3         (R2017a)
     Control System Toolbox                                Version 10.2        (R2017a)
     Curve Fitting Toolbox                                 Version 3.5.5       (R2017a)
     DSP System Toolbox                                    Version 9.4         (R2017a)
     Database Toolbox                                      Version 7.1         (R2017a)
     Datafeed Toolbox                                      Version 5.5         (R2017a)
     Econometrics Toolbox                                  Version 4.0         (R2017a)
     Embedded Coder                                        Version 6.12        (R2017a)
     Filter Design HDL Coder                               Version 3.1.1       (R2017a)
     Financial Instruments Toolbox                         Version 2.5         (R2017a)
     Financial Toolbox                                     Version 5.9         (R2017a)
     Fixed-Point Designer                                  Version 5.4         (R2017a)
     Fuzzy Logic Toolbox                                   Version 2.2.25      (R2017a)
     Global Optimization Toolbox                           Version 3.4.2       (R2017a)
     HDL Coder                                             Version 3.10        (R2017a)
     HDL Verifier                                          Version 5.2         (R2017a)
     Image Acquisition Toolbox                             Version 5.2         (R2017a)
     Image Processing Toolbox                              Version 10.0        (R2017a)
     Instrument Control Toolbox                            Version 3.11        (R2017a)
     LTE System Toolbox                                    Version 2.4         (R2017a)
     MATLAB Coder                                          Version 3.3         (R2017a)
     MATLAB Compiler                                       Version 6.4         (R2017a)
     MATLAB Compiler SDK                                   Version 6.3.1       (R2017a)
     MATLAB Report Generator                               Version 5.2         (R2017a)
     Mapping Toolbox                                       Version 4.5         (R2017a)
     Model Predictive Control Toolbox                      Version 5.2.2       (R2017a)
     Neural Network Toolbox                                Version 10.0        (R2017a)
     Optimization Toolbox                                  Version 7.6         (R2017a)
     Parallel Computing Toolbox                            Version 6.10        (R2017a)
     Partial Differential Equation Toolbox                 Version 2.4         (R2017a)
     Phased Array System Toolbox                           Version 3.4         (R2017a)
     RF Blockset                                           Version 6.0         (R2017a)
     RF Blockset                                           Version 6.0         (R2017a)
     RF Toolbox                                            Version 3.2         (R2017a)
     Robotics System Toolbox                               Version 1.4         (R2017a)
     Robust Control Toolbox                                Version 6.3         (R2017a)
     Signal Processing Toolbox                             Version 7.4         (R2017a)
     SimBiology                                            Version 5.6         (R2017a)
     SimEvents                                             Version 5.2         (R2017a)
     Simscape                                              Version 4.2         (R2017a)
     Simscape Driveline                                    Version 2.12        (R2017a)
     Simscape Electronics                                  Version 2.11        (R2017a)
     Simscape Fluids                                       Version 2.2         (R2017a)
     Simscape Multibody                                    Version 5.0         (R2017a)
     Simscape Power Systems                                Version 6.7         (R2017a)
     Simulink 3D Animation                                 Version 7.7         (R2017a)
     Simulink Code Inspector                               Version 3.0         (R2017a)
     Simulink Coder                                        Version 8.12        (R2017a)
     Simulink Control Design                               Version 4.5         (R2017a)
     Simulink Design Optimization                          Version 3.2         (R2017a)
     Simulink Design Verifier                              Version 3.3         (R2017a)
     Simulink Report Generator                             Version 5.2         (R2017a)
     Simulink Test                                         Version 2.2         (R2017a)
     Simulink Verification and Validation                  Version 3.13        (R2017a)
     Stateflow                                             Version 8.9         (R2017a)
     Statistics and Machine Learning Toolbox               Version 11.1        (R2017a)
     Symbolic Math Toolbox                                 Version 7.2         (R2017a)
     System Identification Toolbox                         Version 9.6         (R2017a)
     Trading Toolbox                                       Version 3.2         (R2017a)
     Vision HDL Toolbox                                    Version 1.4         (R2017a)
     Wavelet Toolbox                                       Version 4.18        (R2017a)
</code></pre>
<h2 id="matlab-execution-in-passive-mode">Matlab execution in passive mode</h2>
<p>For non-interactive or long executions, MATLAB can be ran in passive mode, reading all commands from
an input file you provide (e.g. named INPUTFILE.m) and saving the results in an output file (e.g. named OUTPUTFILE.out),
by either:</p>
<ol>
<li>
<p>using redirection operators:</p>
<pre><code>$&gt; matlab -nodisplay -nosplash &lt; INPUTFILE.m &gt; OUTPUTFILE.out
</code></pre>
</li>
<li>
<p>running the input file as a command (notice the missing '.m' extension) and copying output
(as a log) to the output file:</p>
<pre><code>$&gt; matlab -nodisplay -nosplash -r INPUTFILE -logfile OUTPUTFILE.out
</code></pre>
</li>
</ol>
<p>The second usage mode is recommended as it corresponds to the batch-mode execution. In the first case your
output file will contain the '&gt;&gt;' characters generated by Matlab as if ran interactively, along with the
results of your own commands.</p>
<p>However as the second usage mode runs your script as a command, it <strong>must</strong> contain the <code>quit</code> command at
the end in order to close Matlab, otherwise after the script has executed Matlab will stay open,
waiting for further input until the end of the walltime you set for the passive job, tying up compute
resources needlessly.</p>
<p>The following minimal example shows how to run a serial (1 core) MATLAB script for 24 hours in passive mode:</p>
<pre><code>    (gaia-frontend)$&gt; oarsub -l walltime=24:00:00 "source /etc/profile; module load base/MATLAB; matlab -nodisplay -nosplash &lt; INPUTFILE.m &gt; OUTPUTFILE.out"
</code></pre>
<p>Ideally you <strong>would not</strong> run MATLAB jobs like this but instead <a href="https://github.com/ULHPC/launcher-scripts">create/adapt a launcher script</a> to contain those instructions. A minimal shell script (e.g. named 'your_matlab_launcher.sh') could be:</p>
<pre><code>    #!/bin/bash
    source /etc/profile
    # REMEMBER to change the following to the correct paths of the input/output files:
    INPUTFILE=your_input_file_name_without_extension
    OUTPUTFILE=your_output_file_name_with_extension.out
    # Load a specific version of MATLAB and run the input script:
    module load base/MATLAB/2017a
    matlab -nodisplay -nosplash -r $INPUTFILE -logfile $OUTPUTFILE
</code></pre>
<p>then launch it in a job (e.g. requesting 6 cores on 1 node for 10 hours - assuming your input file takes advantage of the parallel cores):</p>
<pre><code>    (gaia-frontend)$&gt; oarsub -l nodes=1/core=6,walltime=10:00:00 your_matlab_launcher.sh
</code></pre>
<p>Remember! that the Matlab script you run with the '-r' parameter must contain the <code>quit</code> command at the end
in order to close Matlab properly when the script finishes.</p>
<h3 id="example-usage-of-matlab-in-passive-mode">Example usage of Matlab in passive mode</h3>
<p>In this section we will use the <em>example2.m</em> script which shows:
  - the serial execution of time consuming operations; 1 core on 1 node
  - the parallel execution (based on the <code>parfor</code> command) and relative speedup vs serial execution, setting
    the maximum number of parallel threads through environment variables; up to 1 full node
  - GPU-based parallel execution; available only on <a href="https://hpc.uni.lu/systems/accelerators.html">GPU-enabled nodes</a></p>
<p>By default the parallel section of the script uses up to 4 threads, thus for a first test we will:</p>
<ul>
<li>create a <em>launcher script</em> called matlab-minlauncher.sh (paste in your terminal from <code>cat</code> to <code>EOF</code> - <a href="http://tldp.org/LDP/abs/html/here-docs.html">see here how this is done</a>, 
or create the file yourself with the respective content)</li>
<li>make it executable by setting the corresponding filesystem permission (<a href="https://en.wikipedia.org/wiki/Modes_(Unix)">see here for more details</a>)</li>
<li>request from the OAR scheduler 4 cores on 1 compute node for 5 minutes</li>
<li>
<p>wait until the job completes its execution (see its status with <code>oarstat -j $JOBID</code> and full details with <code>oarstat -f -j $JOBID</code>):</p>
<p>(gaia-frontend)$&gt; cd ~/matlab-tutorial/code
  (gaia-frontend)$&gt; cat &lt;&lt; EOF &gt; matlab-minlauncher.sh
  #!/bin/bash
  source /etc/profile
  module load base/MATLAB/2017a
  cd ~/matlab-tutorial/code
  matlab -nodisplay -nosplash -r example2 -logfile example2.out
  EOF
  (gaia-frontend)$&gt; chmod +x matlab-minlauncher.sh
  (gaia-frontend)$&gt; oarsub -l nodes=1/core=4,walltime=00:05:00 ~/matlab-tutorial/code/matlab-minlauncher.sh
  (gaia-frontend)$&gt; cat example2.out
                         &lt; M A T L A B (R) &gt;
               Copyright 1984-2017 The MathWorks, Inc.
                R2017a (9.2.0.538062) 64-bit (glnxa64)
                          February 23, 2017</p>
<p>To get started, type one of these: helpwin, helpdesk, or demo.
  For product information, visit www.mathworks.com.</p>
<p>-- Will perform 24 iterations on a 1000x1000 matrix</p>
<p>-- Serial test
  -- Execution time: 15.143097s.
  -- Parallel tests with up to 4 cores</p>
<p>-- Parallel test using 2 cores
  Starting parallel pool (parpool) using the 'local' profile ...
  connected to 2 workers.
  Parallel pool using the 'local' profile is shutting down.
  -- Execution time: 10.588108s.
  -- Execution time with overhead: 51.693702s.</p>
<p>-- Parallel test using 3 cores
  Starting parallel pool (parpool) using the 'local' profile ...
  connected to 3 workers.
  Parallel pool using the 'local' profile is shutting down.
  -- Execution time: 6.646897s.
  -- Execution time with overhead: 21.025083s.</p>
<p>-- Parallel test using 4 cores
  Starting parallel pool (parpool) using the 'local' profile ...
  connected to 4 workers.
  Parallel pool using the 'local' profile is shutting down.
  -- Execution time: 5.196755s.
  -- Execution time with overhead: 19.772026s.</p>
<p>-- Number of processes, parallel execution time (s), parallel execution time with overhead(s), speedup, speedup with overhead:
    1.0000   15.1431   15.1431    1.0000    1.0000
    2.0000   10.5881   51.6937    1.4302    0.2929
    3.0000    6.6469   21.0251    2.2782    0.7202
    4.0000    5.1968   19.7720    2.9140    0.7659</p>
<p>-- GPU-Parallel test not available on this system.</p>
</li>
</ul>
<p>The next launcher script is also able to read an environment variable <em>MATLABMP</em> and create as many parallel threads as specified in this variable.
We will now generate another launcher which will set this variable to the number of cores we specified to OAR.</p>
<pre><code>(gaia-frontend)$&gt; cd ~/matlab-tutorial/code
(gaia-frontend)$&gt; cat &lt;&lt; EOF &gt; matlab-minlauncher2.sh
#!/bin/bash
source /etc/profile
module load base/MATLAB/2017a
cd ~/matlab-tutorial/code
export MATLABMP=\$(cat $OAR_NODEFILE | wc -l)
matlab -nodisplay -nosplash -r example2 -logfile example2b.out
EOF
(gaia-frontend)$&gt; chmod +x matlab-minlauncher2.sh
(gaia-frontend)$&gt; oarsub -l nodes=1/core=6,walltime=00:05:00 ~/matlab-tutorial/code/matlab-minlauncher2.sh
# we now wait for the job to complete execution - check its progress yourself with oarstat
(gaia-frontend)$&gt; head -n 17 example2b.out
                       &lt; M A T L A B (R) &gt;
             Copyright 1984-2017 The MathWorks, Inc.
              R2017a (9.2.0.538062) 64-bit (glnxa64)
                        February 23, 2017

To get started, type one of these: helpwin, helpdesk, or demo.
For product information, visit www.mathworks.com.

-- Will perform 24 iterations on a 1000x1000 matrix

-- Serial test
-- Execution time: 15.227198s.

-- Found environment variable MATLABMP=6.
-- Parallel tests with up to 6 cores
(gaia-frontend)$&gt;
</code></pre>
<p>We have submitted an OAR job requesting 6 cores for 5 minutes and used the second launcher. It can be seen that the example2.m script has read the MATLABMP environment variable and has used in its execution. Take a look at the MATLAB code to see how this is accomplished.</p>
<p>As shown previously, the jobs we have submitted did not run on GPU-enabled nodes, thus in this last example we will specifically target GPU nodes and see that the last test of example2.m will also be executed.
Before testing the following commands, edit the <code>matlab-minlauncher2.sh</code> script and make MATLAB store its output in a <code>example2c.out</code>
file.</p>
<pre><code>  (gaia-frontend)$&gt; cd ~/matlab-tutorial/code
  (gaia-frontend)$&gt; oarsub -l nodes=1/core=6,walltime=00:05:00 -p "gpu='YES'" ~/matlab-tutorial/code/matlab-minlauncher2.sh
  # now wait for the job to complete execution, then check the output file
  (gaia-frontend)$&gt; tail -n 5 example2c.out
  -- GPU test
  -- GPU Execution time: 19.809493s.
  -- GPU Execution time with overhead: 21.399610s.
  -- GPU vs Serial speedup: 1.249748.
  -- GPU with overhead vs Serial speedup: 1.156884.
</code></pre>
<p>The following plot shows a sample speedup obtained by using parfor on Gaia, with up to 12 parallel threads:
<img alt="Parfor speedup" src="https://raw.github.com/ULHPC/tutorials/devel/advanced/MATLAB1/plots/parfor-speedup.png" /></p>
<p>Relative to the fast execution of the inner instruction (which calculates the eigenvalues of a matrix)
the overhead given by the creation of the parallel pool and the task assignations is quite high in this example,
where for 12 cores the speedup is 5.26x but taking the overhead into account it is only 4x.</p>
<h2 id="useful-references">Useful references</h2>
<ul>
<li><a href="http://nl.mathworks.com/help/distcomp/getting-started-with-parallel-computing-toolbox.html">Getting Started with Parallel Computing Toolbox</a></li>
<li><a href="https://nl.mathworks.com/help/distcomp/parfor.html">Parallel for-Loops (parfor) documentation</a></li>
<li><a href="https://nl.mathworks.com/discovery/matlab-gpu.html">GPU Computing documentation</a></li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../R/" class="btn btn-neutral float-right" title="R - statistical computing">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../HPCG/" class="btn btn-neutral" title="High Performance Conjugate Gradient (HPCG)"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../../HPCG/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../R/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
